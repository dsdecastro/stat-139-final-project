total.headcount + undergrad.headcount + percent.american.native +
percent.asian + percent.black + percent.hispanic.latino +
percent.pacific.islander + percent.white + percent.two.more.races +
percent.NA.race + percent.disability + catholic +
dorm.capacity + private + mask.mandated.days + religious,
data=full.cases)
lm2 <- lm(log(total.cases + epsilon) ~ . - FIPS.state.code - ipeds_id +
institution.name - occupational.degree - academic.degree -
hs.equivalent.degree - NCAA.football - on.campus.housing -
dorm.room.price - city - college - cases - cases_2021,
data=full.cases)
apply(colnames(full.cases), is.factor)
apply(colnames(full.cases), FUN=is.factor)
apply(full.cases, MARGIN=1, FUN=is.factor)
apply(full.cases, MARGIN=2, FUN=is.factor)
full.cases$academic.degree
full.cases$occupational.degree
colnames(full.caes)
colnames(full.cases)
is.factor(full.cases$on.campus.housing)
sapply(full.cases, is.factor)
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
# Read colleges from csv
colleges <- read.csv("data/colleges.csv")[,-c(1,9)]
# Read ipeds from csv, drop unnecessary columns
ipeds <- read.csv("data/ipeds.csv")
ipeds <- ipeds[-c(3, 8, 22)]
# Rename columns of ipeds
ipeds <- ipeds %>% rename_at('IC2021.Institutional.control.or.affiliation',
~'control') %>%
rename_at('HD2021.FIPS.state.code', ~'FIPS.state.code') %>%
rename_at('unitid', ~'ipeds_id') %>%
rename_at('IC2021.Religious.affiliation',
~'religious.affiliation') %>%
rename_at('DRVIC2021.Tuition.and.fees..2020.21',
~'tuition') %>%
rename_at('DRVEF122021.Total.12.month.unduplicated.headcount',
~'total.headcount') %>%
rename_at('DRVEF122021.Undergraduate.12.month.unduplicated.headcount',
~'undergrad.headcount') %>%
rename_at('DRVEF122021.Percent.of.12.month.unduplicated.headcount.that.are.American.Indian.or.Alaska.Native',
~'percent.american.native') %>%
rename_at('DRVEF122021.Percent.of.12.month.unduplicated.headcount.that.are.Asian',
~'percent.asian') %>%
rename_at('DRVEF122021.Percent.of.12.month.unduplicated.headcount.that.are.Black.or.African.American',
~'percent.black') %>%
rename_at('DRVEF122021.Percent.of.12.month.unduplicated.headcount.that.are.Hispanic.Latino', ~'percent.hispanic.latino') %>%
rename_at('DRVEF122021.Percent.of.12.month.unduplicated.headcount.that.are.Native.Hawaiian.or.Other.Pacific.Islander',
~'percent.pacific.islander') %>%
rename_at('DRVEF122021.Percent.of.12.month.unduplicated.headcount.that.are.White',
~'percent.white') %>%
rename_at('DRVEF122021.Percent.of.12.month.unduplicated.headcount.that.are.two.or.more.races',
~'percent.two.more.races') %>%
rename_at('DRVEF122021.Percent.of.12.month.unduplicated.headcount.that.are.race.ethnicity.unknown', ~'percent.NA.race') %>%
rename_at('DRVEF122021.Percent.of.12.month.unduplicated.headcount.that.are.Nonresident.Alien',
~'percent.nonres.alien') %>%
rename_at('DRVEF122021.Percent.of.12.month.unduplicated.headcount.that.are.women', ~'percent.women') %>%
rename_at('SFA2021.Average.amount.of.grant.and.scholarship.aid.awarded..2020.21', ~'avg.grant.money') %>%
rename_at('DRVGR2021.Graduation.rate..total.cohort', ~'grad.rate') %>%
rename_at('SFA2021.Percent.of.full.time.first.time.undergraduates.awarded.any.financial.aid',
~'percent.fin.aid') %>%
rename_at('SFA2021.Percent.of.full.time.first.time.undergraduates.awarded.student.loans',
~'percent.student.loan') %>%
rename_at('IC2021.Occupational', ~'occupational.degree') %>%
rename_at('IC2021.Academic', ~'academic.degree') %>%
rename_at('IC2021.Adult.basic.remedial.or.high.school.equivalent',
~'hs.equivalent.degree') %>%
rename_at('IC2021.Percent.of.undergraduates..who.are.formally.registered.as.students.with.disabilities..when.percentage.is.more.than.3.percent',
~'percent.disability') %>%
rename_at('IC2021.NCAA.NAIA.conference.number.football',
~'NCAA.football') %>%
rename_at('IC2021.Institution.provide.on.campus.housing',
~'on.campus.housing') %>%
rename_at('IC2021.Total.dormitory.capacity',
~'dorm.capacity') %>%
rename_at('IC2021.Typical.room.charge.for.academic.year',
~'dorm.room.price')
# Merge data frames, and remove duplicated "state" column
md <- merge(ipeds, colleges, by="ipeds_id")[,-32]
# Remove institutions with no ipeds data (a lot of NAs)
md <- md[!(md$control == ""),]
# Create column 'religious'
md$religious <- "Yes"
md[md$religious.affiliation == "Not applicable", ]$religious <- "No"
# Create column 'catholic'
md$catholic <- "No"
md[md$religious.affiliation == "Roman Catholic",]$catholic <- "Yes"
# Create column 'private'
md$private <- "No"
md$private[md$control == "Private not-for-profit (no religious affiliation)" |
md$control == "Private not-for-profit (religious affiliation)"] <-
"Yes"
# Drop column 'control'
md <- md[,-4]
# Write to csv
write.csv(md,'merged_cases.csv')
# Read mask.mandates from CSV file
mask.mandates <- read.csv("data/U.S._State_and_Territorial_Public_Mask_Mandates_From_April_8__2020_through_August_15__2021_by_State_by_Day.csv")
# Convert appropriate columns to factors
factor.variables <- c("Face_Masks_Required_in_Public", "State_Tribe_Territory", "order_code")
mask.mandates[,factor.variables] <- lapply(mask.mandates[,factor.variables], as.factor)
# Convert column 'date' to type Date from string
mask.mandates$date <- as.Date(mask.mandates$date, format="%m/%d/%Y")
# Create new data frame to merge with md
mandates.by.state <- data.frame(state=unique(mask.mandates$State_Tribe_Territory))
# Create and fill column 'mask.mandated.days'
mandates.by.state$mask.mandated.days <- 0
for (i in 1:length(unique(mandates.by.state$state))) {
dummy <- mask.mandates$Face_Masks_Required_in_Public[mask.mandates$State_Tribe_Territory == mandates.by.state$state[i]
& mask.mandates$date >= as.Date("2020/7/1")
& mask.mandates$date <= as.Date("2021/5/26")]
dummy[is.na(dummy)] <- "No"
mandates.by.state$mask.mandated.days[mandates.by.state$state == mandates.by.state$state[i]] = sum(dummy == "Yes")
}
# Add state names to mandates.by.state
mandates.by.state$full_state_name <- c("Alaska", "Alabama", "Arkansas",
"American Samoa", "Arizona",
"California", "Colorado",
"District of Columbia", "Connecticut",
"Florida", "Delaware", "Georgia", "Guam",
"Iowa", "Hawaii", "Idaho", "Illinois",
"Indiana", "Kansas", "Kentucky",
"Louisiana", "Massachusetts",
"Minnesota", "Maryland", "Maine",
"Michigan", "Missouri",
"Northern Mariana Islands",
"Mississippi", "Montana",
"North Carolina", "North Dakota",
"Nebraska", "New Hampshire", "Nevada",
"New Jersey", "New Mexico", "Ohio",
"New York", "Oklahoma", "Oregon",
"South Carolina", "Rhode Island",
"Pennsylvania", "Puerto Rico",
"South Dakota", "Tennessee", "Texas",
"Utah", "Virginia", "Virgin Islands",
"Vermont", "Washington", "Wisconsin",
"West Virginia", "Wyoming")
# Drop state abbreviation column and reorder remaining two columns
mandates.by.state <- mandates.by.state[,c(3,2)]
# Merge md and mandates.by.state data frames on name of state
full.cases <- merge(md, mandates.by.state, by.x="FIPS.state.code",
by.y="full_state_name")
# Create total.cases column
full.cases$total.cases <- full.cases$cases + full.cases$cases_2021
# Convert necessary columns to factors
factor.variables <- c("religious", "FIPS.state.code", "private",
"occupational.degree", "academic.degree",
"hs.equivalent.degree", "NCAA.football",
"on.campus.housing", "catholic", "state")
full.cases[,factor.variables] <- lapply(full.cases[,factor.variables], as.factor)
# Write to csv
write.csv(full.cases, file="data/full_cases.csv")
epsilon <- 1
par(mfrow=c(1,2))
hist(full.cases$total.cases, main="total.cases, untransformed")
hist(log(full.cases$total.cases + epsilon), main="total.cases, log-transformed")
t.test(log(total.cases + epsilon) ~ religious, data=full.cases)
t.test(log(total.cases + epsilon) ~ catholic, data=full.cases)
for.rel.affil <- full.cases[,c("total.cases", "religious.affiliation")]
for.rel.affil <- for.rel.affil[complete.cases(for.rel.affil),]
summary(aov(total.cases ~ religious.affiliation, data=for.rel.affil))
wilcox.test(x = full.cases$total.cases[full.cases$religious == "Yes"],
y = full.cases$total.cases[full.cases$religious == "No"],
alternative='two.sided', exact = FALSE, correct = FALSE,
conf.int = TRUE)
lm2 <- lm(log(total.cases + epsilon) ~ . - FIPS.state.code - ipeds_id +
institution.name - occupational.degree - academic.degree -
hs.equivalent.degree - NCAA.football - on.campus.housing -
city - college - cases - cases_2021,
data=full.cases)
sapply(full.cases, is.factor)
sapply(full.cases, typeof)
sapply(full.cases, is.factor)
lm2 <- lm(log(total.cases + epsilon) ~ . - FIPS.state.code - ipeds_id +
institution.name - occupational.degree - academic.degree -
hs.equivalent.degree - NCAA.football - on.campus.housing -
city - college - cases - cases_2021 - state - catholic - private - religious,
data=full.cases)
for (i in 1:length(colnames(full.cases))) {
dummy <- lm(full.cases$total.cases ~ full.cases[,i])
print(colnames(full.cases)[i])
}
lm2 <- lm(log(total.cases + epsilon) ~ . - FIPS.state.code - ipeds_id -
institution.name - occupational.degree - academic.degree -
hs.equivalent.degree - NCAA.football - on.campus.housing -
city - college - cases - cases_2021 - state - catholic - private - religious,
data=full.cases)
for (i in 1:length(colnames(full.cases))) {
dummy <- lm(full.cases$total.cases ~ full.cases[,i])
print(colnames(full.cases)[i])
print(head(full.cases[,i]))
}
is.na(full.cases$cases_2021)
is.na(full.cases$cases)
sum(is.na(full.cases$cases))
lm2 <- lm(log(cases + epsilon) ~ . - FIPS.state.code - ipeds_id -
institution.name - occupational.degree - academic.degree -
hs.equivalent.degree - NCAA.football - on.campus.housing -
city - college - cases_2021 - state - catholic - private - religious - total.cases,
data=full.cases)
for (i in 1:length(colnames(full.cases))) {
dummy <- lm(full.cases$total.cases ~ full.cases[,i])
print(colnames(full.cases)[i])
print(head(full.cases[,i]))
}
lm2 <- lm(log(total.cases + epsilon) ~ . - FIPS.state.code - ipeds_id -
institution.name - occupational.degree - academic.degree -
hs.equivalent.degree - NCAA.football - on.campus.housing -
city - college - cases_2021 - state - catholic - private - religious - total.cases - percent.disability,
data=full.cases)
length(colnames(full.cases))
colnames(full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious)
lm3 <- lm(log(total.cases + epsilon) ~ religious,
data=full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious + catholic + religious.affiliation + tuition + total.headcount,
data=full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious + catholic + religious.affiliation + tuition + total.headcount + undergrad.headcount + percent.american.native + percent.asian + percent.black + percent.hispanic.latino + percent.pacific.islander + percent.white + percent.two.more.races + percent.NA.race,
data=full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious + catholic + religious.affiliation + tuition + total.headcount + undergrad.headcount + percent.american.native + percent.asian + percent.black + percent.hispanic.latino + percent.pacific.islander + percent.white + percent.two.more.races + percent.NA.race + percent.nonres.alien,
data=full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious + catholic + religious.affiliation + tuition + total.headcount + undergrad.headcount + percent.american.native + percent.asian + percent.black + percent.hispanic.latino + percent.pacific.islander + percent.white + percent.two.more.races + percent.NA.race + percent.nonres.alien + percent.women + avg.grant.money,
data=full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious + catholic + religious.affiliation + tuition + total.headcount + undergrad.headcount + percent.american.native + percent.asian + percent.black + percent.hispanic.latino + percent.pacific.islander + percent.white + percent.two.more.races + percent.NA.race + percent.nonres.alien + percent.women,
data=full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious + catholic + religious.affiliation + tuition + total.headcount + undergrad.headcount + percent.american.native + percent.asian + percent.black + percent.hispanic.latino + percent.pacific.islander + percent.white + percent.two.more.races + percent.NA.race + percent.nonres.alien + percent.women + grad.rate,
data=full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious + catholic + religious.affiliation + tuition + total.headcount + undergrad.headcount + percent.american.native + percent.asian + percent.black + percent.hispanic.latino + percent.pacific.islander + percent.white + percent.two.more.races + percent.NA.race + percent.nonres.alien + percent.women + grad.rate + percent.fin.aid,
data=full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious + catholic + religious.affiliation + tuition + total.headcount + undergrad.headcount + percent.american.native + percent.asian + percent.black + percent.hispanic.latino + percent.pacific.islander + percent.white + percent.two.more.races + percent.NA.race + percent.nonres.alien + percent.women + grad.rate + percent.fin.aid + NCAA.football + percent.disability + on.campus.housing,
data=full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious + catholic + religious.affiliation + tuition + total.headcount + undergrad.headcount + percent.american.native + percent.asian + percent.black + percent.hispanic.latino + percent.pacific.islander + percent.white + percent.two.more.races + percent.NA.race + percent.nonres.alien + percent.women + grad.rate + percent.fin.aid + NCAA.football + percent.disability + on.campus.housing + dorm.capacity,
data=full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious + catholic + religious.affiliation + tuition + total.headcount + undergrad.headcount + percent.american.native + percent.asian + percent.black + percent.hispanic.latino + percent.pacific.islander + percent.white + percent.two.more.races + percent.NA.race + percent.nonres.alien + percent.women + grad.rate + percent.fin.aid + NCAA.football + percent.disability + on.campus.housing + dorm.capacity,
data=full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious + catholic + religious.affiliation + tuition + total.headcount + undergrad.headcount + percent.american.native + percent.asian + percent.black + percent.hispanic.latino + percent.pacific.islander + percent.white + percent.two.more.races + percent.NA.race + percent.nonres.alien + percent.women + grad.rate + percent.fin.aid + NCAA.football + percent.disability + on.campus.housing,
data=full.cases)
is.factor(dorm.capacity)
is.factor(full.casesdorm.capacity)
is.factor(full.cases$dorm.capacity)
unique(dorm.capacity)
unique(full.cases$dorm.capacity)
colnames(full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious + catholic + religious.affiliation + tuition + total.headcount + undergrad.headcount + percent.american.native + percent.asian + percent.black + percent.hispanic.latino + percent.pacific.islander + percent.white + percent.two.more.races + percent.NA.race + percent.nonres.alien + percent.women + grad.rate + percent.fin.aid + NCAA.football + percent.disability + on.campus.housing + dorm.room.price,
data=full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious + catholic + religious.affiliation + tuition + total.headcount + undergrad.headcount + percent.american.native + percent.asian + percent.black + percent.hispanic.latino + percent.pacific.islander + percent.white + percent.two.more.races + percent.NA.race + percent.nonres.alien + percent.women + grad.rate + percent.fin.aid + NCAA.football + percent.disability + on.campus.housing + state + private + mask.mandated.days,
data=full.cases)
colnames(full.cases)
lm1 <- lm(log(total.cases + epsilon) ~ . - (avg.grant.money + dorm.capacity + dorm.room.price + FIPS.state.code + city + college + ipeds_id + institution.name + cases + cases_2021), data=full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious + catholic + religious.affiliation + tuition + total.headcount + undergrad.headcount + percent.american.native + percent.asian + percent.black + percent.hispanic.latino + percent.pacific.islander + percent.white + percent.two.more.races + percent.NA.race + percent.nonres.alien + percent.women + grad.rate + percent.fin.aid + NCAA.football + percent.disability + on.campus.housing + state + private + mask.mandated.days + percent.student.loan,
data=full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious + catholic + religious.affiliation + tuition + total.headcount + undergrad.headcount + percent.american.native + percent.asian + percent.black + percent.hispanic.latino + percent.pacific.islander + percent.white + percent.two.more.races + percent.NA.race + percent.nonres.alien + percent.women + grad.rate + percent.fin.aid + NCAA.football + percent.disability + on.campus.housing + state + private + mask.mandated.days + percent.student.loan + occupational.degree,
data=full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious + catholic + religious.affiliation + tuition + total.headcount + undergrad.headcount + percent.american.native + percent.asian + percent.black + percent.hispanic.latino + percent.pacific.islander + percent.white + percent.two.more.races + percent.NA.race + percent.nonres.alien + percent.women + grad.rate + percent.fin.aid + NCAA.football + percent.disability + on.campus.housing + state + private + mask.mandated.days + percent.student.loan + occupational.degree + hs.equivalent.degree,
data=full.cases)
lm1 <- lm(log(total.cases + epsilon) ~ . - (avg.grant.money + dorm.capacity + dorm.room.price + FIPS.state.code + city + college + ipeds_id + institution.name + cases + cases_2021 + academic.degree), data=full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious + catholic + religious.affiliation + tuition + total.headcount + undergrad.headcount + percent.american.native + percent.asian + percent.black + percent.hispanic.latino + percent.pacific.islander + percent.white + percent.two.more.races + percent.NA.race + percent.nonres.alien + percent.women + grad.rate + percent.fin.aid + NCAA.football + percent.disability + on.campus.housing + state + private + mask.mandated.days + percent.student.loan + occupational.degree + hs.equivalent.degree + academic.degree,
data=full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious + catholic + religious.affiliation + tuition + total.headcount + undergrad.headcount + percent.american.native + percent.asian + percent.black + percent.hispanic.latino + percent.pacific.islander + percent.white + percent.two.more.races + percent.NA.race + percent.nonres.alien + percent.women + grad.rate + percent.fin.aid + NCAA.football + percent.disability + on.campus.housing + state + private + mask.mandated.days + percent.student.loan + occupational.degree + hs.equivalent.degree,
data=full.cases)
lm1 <- lm(log(total.cases + epsilon) ~ . - (avg.grant.money + dorm.capacity + dorm.room.price + FIPS.state.code + city + college + ipeds_id + institution.name + cases + cases_2021 + academic.degree), data=full.cases)
colnames(full.cases)
lm1 <- lm(log(total.cases + epsilon) ~ . - (avg.grant.money + dorm.capacity + dorm.room.price + FIPS.state.code + city + college + ipeds_id + institution.name + cases + cases_2021 + academic.degree), data=full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious + catholic + religious.affiliation + tuition + total.headcount + undergrad.headcount + percent.american.native + percent.asian + percent.black + percent.hispanic.latino + percent.pacific.islander + percent.white + percent.two.more.races + percent.NA.race + percent.nonres.alien + percent.women + grad.rate + percent.fin.aid + NCAA.football + percent.disability + on.campus.housing + state + private + mask.mandated.days + percent.student.loan + occupational.degree + hs.equivalent.degree,
data=full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious + catholic + religious.affiliation + tuition + total.headcount + undergrad.headcount + percent.american.native + percent.asian + percent.black + percent.hispanic.latino + percent.pacific.islander + percent.white + percent.two.more.races + percent.NA.race + percent.nonres.alien + percent.women + grad.rate + percent.fin.aid + NCAA.football + percent.disability + on.campus.housing + state + private + mask.mandated.days + percent.student.loan + occupational.degree + hs.equivalent.degree + dorm.room.price,
data=full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious + catholic + religious.affiliation + tuition + total.headcount + undergrad.headcount + percent.american.native + percent.asian + percent.black + percent.hispanic.latino + percent.pacific.islander + percent.white + percent.two.more.races + percent.NA.race + percent.nonres.alien + percent.women + grad.rate + percent.fin.aid + NCAA.football + percent.disability + on.campus.housing + state + private + mask.mandated.days + percent.student.loan + occupational.degree + hs.equivalent.degree,
data=full.cases)
lm3 <- lm(log(total.cases + epsilon) ~ religious + catholic +
religious.affiliation + tuition + total.headcount +
undergrad.headcount + percent.american.native + percent.asian +
percent.black + percent.hispanic.latino + percent.pacific.islander +
percent.white + percent.two.more.races + percent.NA.race +
percent.nonres.alien + percent.women + grad.rate + percent.fin.aid +
NCAA.football + percent.disability + on.campus.housing + state +
private + mask.mandated.days + percent.student.loan +
occupational.degree + hs.equivalent.degree,
data=full.cases)
summary(lm3)
# Not included in the below model: NCAA.football, religious.affiliation
lm1 <- lm(log(total.cases + epsilon) ~ religious + catholic +
tuition + total.headcount +
undergrad.headcount + percent.american.native + percent.asian +
percent.black + percent.hispanic.latino + percent.pacific.islander +
percent.white + percent.two.more.races + percent.NA.race +
percent.nonres.alien + percent.women + grad.rate + percent.fin.aid +
percent.disability + on.campus.housing + state +
private + mask.mandated.days + percent.student.loan +
occupational.degree + hs.equivalent.degree,
data=full.cases)
# No idea why the below does not work
# lm1 <- lm(log(total.cases + epsilon) ~ . - (avg.grant.money + dorm.capacity + dorm.room.price + FIPS.state.code + city + college + ipeds_id + institution.name + cases + cases_2021 + academic.degree), data=full.cases)
# bad <- c("avg.grant.money", "dorm.capacity", "dorm.room.price", )
summary(lm1)
# Not included in the below model: NCAA.football, religious.affiliation,
# mask.mandated days, as well as those subtracted from the formula of
# the commented out lm1 below
lm1 <- lm(log(total.cases + epsilon) ~ religious + catholic +
tuition + total.headcount +
undergrad.headcount + percent.american.native + percent.asian +
percent.black + percent.hispanic.latino + percent.pacific.islander +
percent.white + percent.two.more.races + percent.NA.race +
percent.nonres.alien + percent.women + grad.rate + percent.fin.aid +
percent.disability + on.campus.housing + state +
private + percent.student.loan +
occupational.degree + hs.equivalent.degree,
data=full.cases)
# No idea why the below does not work
# lm1 <- lm(log(total.cases + epsilon) ~ . - (avg.grant.money + dorm.capacity + dorm.room.price + FIPS.state.code + city + college + ipeds_id + institution.name + cases + cases_2021 + academic.degree), data=full.cases)
# bad <- c("avg.grant.money", "dorm.capacity", "dorm.room.price", )
summary(lm1)
plot(lm1$residuals ~ lm1$fitted.values)
plot(lm1$residuals ~ lm1$fitted.values)
abline(h=0)
plot(lm1$residuals ~ lm1$fitted.values)
abline(h=0, col="gray", lty=2)
plot(lm1$residuals ~ lm1$fitted.values)
abline(h=0, col="gray", lty=2)
help(qqline)
qqline()
qqnorm(full.cases$total.cases)
qqline()
qqnorm(log(full.cases$total.cases + epsilon))
qqline(log(full.cases$total.cases + epsilon))
hist(log(full.cases$total.cases + epsilon))
hist(log(full.cases$total.cases + epsilon), main="total.cases, log-transformed")
qqnorm(log(full.cases$total.cases + epsilon))
qqline(log(full.cases$total.cases + epsilon))
plot(lm1$residuals ~ lm1$fitted.values)
abline(h=0, col="gray", lty=2)
sapply(full.cases, is.factor)
par(mfrow=c(3,1))
plot(total.cases ~ tuition, data=full.cases)
plot(total.cases ~ total.headcount, data=full.cases)
plot(total.cases ~ undergraduate.headcount, data=full.cases)
par(mfrow=c(3,1))
plot(total.cases ~ tuition, data=full.cases)
plot(total.cases ~ total.headcount, data=full.cases)
plot(total.cases ~ undergrad.headcount, data=full.cases)
par(mfrow=c(2,2))
plot(total.cases ~ tuition, data=full.cases)
plot(total.cases ~ total.headcount, data=full.cases)
plot(total.cases ~ undergrad.headcount, data=full.cases)
# par(mfrow=c(2,2))
plot(total.cases ~ tuition, data=full.cases)
plot(total.cases ~ total.headcount, data=full.cases)
plot(total.cases ~ undergrad.headcount, data=full.cases)
sapply(full.cases, is.factor)
plot(lm1$residuals ~ lm1$fitted.values)
abline(h=0, col="gray", lty=2)
# par(mfrow=c(2,2))
plot(log(total.cases + epsilon) ~ tuition, data=full.cases)
plot(log(total.cases + epsilon) ~ total.headcount, data=full.cases)
plot(log(total.cases + epsilon) ~ undergrad.headcount, data=full.cases)
max(full.cases$total.headcount)
max(na.omit(full.cases$total.headcount))
full.cases[full.cases$total.headcount == 198776, ]
max(na.omit(full.cases$undergrad.headcount), 5)
max(na.omit(full.cases$undergrad.headcount), 8)
head(sort(na.omit(full.cases$undergrad.headcount)),5)
head(sort(na.omit(full.cases$undergrad.headcount), descending=T),5)
head(sort(na.omit(full.cases$undergrad.headcount), decreasing=T),5)
full.cases[full.cases$undergrad.headcount %in% head(sort(na.omit(full.cases$undergrad.headcount), decreasing=T),5), ]
library(dplyr)
library(rpart)
library(randomForest)
?rpart
tree1 <- rpart(log(total.cases + epsilon) ~ religious + catholic +
tuition + total.headcount +
undergrad.headcount + percent.american.native + percent.asian +
percent.black + percent.hispanic.latino + percent.pacific.islander +
percent.white + percent.two.more.races + percent.NA.race +
percent.nonres.alien + percent.women + grad.rate + percent.fin.aid +
percent.disability + on.campus.housing + state +
private + percent.student.loan +
occupational.degree + hs.equivalent.degree,
data=full.cases)
library(rpart.plot)
tree1$variable.importance
rpart.plot(tree1)
?rpart
tree1 <- rpart(log(total.cases + epsilon) ~ religious + catholic +
tuition + total.headcount +
undergrad.headcount + percent.american.native + percent.asian +
percent.black + percent.hispanic.latino + percent.pacific.islander +
percent.white + percent.two.more.races + percent.NA.race +
percent.nonres.alien + percent.women + grad.rate + percent.fin.aid +
percent.disability + on.campus.housing + state +
private + percent.student.loan +
occupational.degree + hs.equivalent.degree,
data=full.cases, control=list(minsplit=1, cp=0))
tree1$variable.importance
rpart.plot(tree1)
tree1 <- rpart(log(total.cases + epsilon) ~ religious + catholic +
tuition + total.headcount +
undergrad.headcount + percent.american.native + percent.asian +
percent.black + percent.hispanic.latino + percent.pacific.islander +
percent.white + percent.two.more.races + percent.NA.race +
percent.nonres.alien + percent.women + grad.rate + percent.fin.aid +
percent.disability + on.campus.housing + state +
private + percent.student.loan +
occupational.degree + hs.equivalent.degree,
data=full.cases, control=list(minsplit=1, cp=0, maxdepth=20))
tree1$variable.importance
rpart.plot(tree1)
tree1 <- rpart(log(total.cases + epsilon) ~ religious + catholic +
tuition + total.headcount +
undergrad.headcount + percent.american.native + percent.asian +
percent.black + percent.hispanic.latino + percent.pacific.islander +
percent.white + percent.two.more.races + percent.NA.race +
percent.nonres.alien + percent.women + grad.rate + percent.fin.aid +
percent.disability + on.campus.housing + state +
private + percent.student.loan +
occupational.degree + hs.equivalent.degree,
data=full.cases)
tree1$variable.importance
rpart.plot(tree1)
tree1 <- rpart(log(total.cases + epsilon) ~ religious + catholic +
tuition + total.headcount +
undergrad.headcount + percent.american.native + percent.asian +
percent.black + percent.hispanic.latino + percent.pacific.islander +
percent.white + percent.two.more.races + percent.NA.race +
percent.nonres.alien + percent.women + grad.rate + percent.fin.aid +
percent.disability + on.campus.housing + state +
private + percent.student.loan +
occupational.degree + hs.equivalent.degree,
data=full.cases, control=list(minsplit=1, cp=0, maxdepth=20))
tree1$variable.importance
rpart.plot(tree1)
tree1 <- rpart(log(total.cases + epsilon) ~ religious + catholic +
tuition + total.headcount +
undergrad.headcount + percent.american.native + percent.asian +
percent.black + percent.hispanic.latino + percent.pacific.islander +
percent.white + percent.two.more.races + percent.NA.race +
percent.nonres.alien + percent.women + grad.rate + percent.fin.aid +
percent.disability + on.campus.housing + state +
private + percent.student.loan +
occupational.degree + hs.equivalent.degree,
data=full.cases, control=list(minsplit=1, cp=0, maxdepth=20))
tree1$variable.importance
tree2 <- prune(tree1, tree1$cptable[,"CP"][which.min(tree1$cptable[,"xerror"])])
rpart.plot(tree2)
RMSE = function(y,yhat){
SSE = sum((y-yhat)ˆ2) return(sqrt(SSE/length(y)))
RMSE = function(y,yhat){
SSE = sum((y-yhat)ˆ2)
RMSE = function(y,yhat){
SSE = sum((y-yhat)ˆ2)
RMSE = function(y,yhat){
SSE = sum((y-yhat)ˆ2)
RMSE = function(y,yhat){
SSE = sum((y-yhat)ˆ2)
RMSE <- function(y,yhat){
SSE = sum((y-yhat)ˆ2)
RMSE <- function(y, yhat) {
SSE = sum((y-yhat)^2)
return(sqrt(SSE/length(y)))
}
mtry <- 39
maxnodes.bag <- c(50,100,200,500)
ntree <- 200
train.RMSE <- matrix(nrow=length(maxnodes.bag), ncol=1)
for (i in 1:length(maxnodes.bag)) {
rf <- randomForest(formula(lm1), data=full.cases, maxnodes=maxnodes.bag,
ntree=ntree, mtry=length(colnames(full.cases)) - 1)
train.RMSE[i,1] <- RMSE(log(full.cases$total.cases + epsilon), rf$predicted)
}
sum(!complete.cases(model.matrix(lm1)))
mtry <- 39
maxnodes.bag <- c(50,100,200,500)
ntree <- 200
train.RMSE <- matrix(nrow=length(maxnodes.bag), ncol=1)
for (i in 1:length(maxnodes.bag)) {
rf <- randomForest(formula(lm1), data=model.matrix(lm1), maxnodes=maxnodes.bag,
ntree=ntree, mtry=length(colnames(full.cases)) - 1)
train.RMSE[i,1] <- RMSE(log(full.cases$total.cases + epsilon), rf$predicted)
}
mtry <- 39
maxnodes.bag <- c(50,100,200,500)
ntree <- 200
train.RMSE <- matrix(nrow=length(maxnodes.bag), ncol=1)
for (i in 1:length(maxnodes.bag)) {
rf <- randomForest(total.cases ~ ., data=model.matrix(lm1), maxnodes=maxnodes.bag,
ntree=ntree, mtry=length(colnames(full.cases)) - 1)
train.RMSE[i,1] <- RMSE(log(full.cases$total.cases + epsilon), rf$predicted)
}
?randomForest
formula(lm1)
colnames(model.matrix(lm1))
dim(model.matrix(lm1))
formula(lm1)
mtry <- 39
maxnodes.bag <- c(50,100,200,500)
ntree <- 200
train.RMSE <- matrix(nrow=length(maxnodes.bag), ncol=1)
for (i in 1:length(maxnodes.bag)) {
rf <- randomForest(log(total.cases + epsilon) ~ religious + catholic+tuition +
total.headcount + undergrad.headcount + percent.american.native +
percent.asian + percent.black + percent.hispanic.latino +
percent.pacific.islander + percent.white + percent.two.more.races +
percent.NA.race + percent.nonres.alien + percent.women +
grad.rate + percent.fin.aid + percent.disability + on.campus.housing +
state + private + percent.student.loan + occupational.degree +
hs.equivalent.degree, data=full.cases,
maxnodes=maxnodes.bag,
ntree=ntree, mtry=length(colnames(full.cases)) - 1)
train.RMSE[i,1] <- RMSE(log(full.cases$total.cases + epsilon), rf$predicted)
}
plot(lm1$residuals ~ lm1$fitted.values)
abline(h=0, col="gray", lty=2)
